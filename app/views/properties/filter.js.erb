$('.loader').show();

// update listings
$("#listings .listing-body>ul").html("<%= escape_javascript(render partial: 'properties/listing_item') %>").animate({ scrollTop: 0 }, "slow");

// attach liting images
$('.listing-img').css('background-image', function(){
  return "url(" + $(this).data('bg') + ")";
});

// update listing count
$('#listing-count').html("<%= escape_javascript("#{@properties.count}")%>");

// attach listener to makerrs
$('.listing-body>ul>li').click(function(){
  var pid = $(this).data('pid');
  $('#p-' + pid).toggle();
  toggleOverview(pid);
  overviewToggled = true;

  mapMarkers.forEach(function(m){
    if (m.pid === pid) {
      var marker = m;
      infoWindows.forEach(function(info){
        if (info.pid === pid) {
          closeAllInfoWin();
          info.open(map, marker);
          $(".gm-style-iw").prev("div").hide();
        }
      });
    }
  });
});

// update map markers
updateMarkers(<%= @properties.to_json(include: [:address]).html_safe %>);

setTimeout(function() 
  { 
    $('.listing-filters').hide();
    $('.loader').fadeOut(); 
  }, 1000);